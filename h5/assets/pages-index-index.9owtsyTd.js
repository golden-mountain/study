import{_ as e,o as t,c as i,w as s,a as r,n as o,b as l,r as a,d,i as n,e as u,f as h,g as c,h as g,j as p,k as m,l as f,m as _,p as k}from"./index-h3lAx3Le.js";import{U as C}from"./UserInfo.DLZ9WXF6.js";import"./auth.CK2ut5yY.js";const v=e({name:"UniGridItem",inject:["grid"],props:{index:{type:Number,default:0}},data:()=>({column:0,showBorder:!0,square:!0,highlight:!0,left:0,top:0,openNum:2,width:0,borderColor:"#e5e5e5"}),created(){this.column=this.grid.column,this.showBorder=this.grid.showBorder,this.square=this.grid.square,this.highlight=this.grid.highlight,this.top=0===this.hor?this.grid.hor:this.hor,this.left=0===this.ver?this.grid.ver:this.ver,this.borderColor=this.grid.borderColor,this.grid.children.push(this),this.width=this.grid.width},beforeDestroy(){this.grid.children.forEach(((e,t)=>{e===this&&this.grid.children.splice(t,1)}))},methods:{_onClick(){this.grid.change({detail:{index:this.index}})}}},[["render",function(e,u,h,c,g,p){const m=n;return g.width?(t(),i(m,{key:0,style:l("width:"+g.width+";"+(g.square?"height:"+g.width:"")),class:"uni-grid-item"},{default:s((()=>[r(m,{class:o([{"uni-grid-item--border":g.showBorder,"uni-grid-item--border-top":g.showBorder&&h.index<g.column,"uni-highlight":g.highlight},"uni-grid-item__box"]),style:l({"border-right-color":g.borderColor,"border-bottom-color":g.borderColor,"border-top-color":g.borderColor}),onClick:p._onClick},{default:s((()=>[a(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style","onClick"])])),_:3},8,["style"])):d("",!0)}],["__scopeId","data-v-bcc8bb70"]]);const b=e({name:"UniGrid",emits:["change"],props:{column:{type:Number,default:3},showBorder:{type:Boolean,default:!0},borderColor:{type:String,default:"#D2D2D2"},square:{type:Boolean,default:!0},highlight:{type:Boolean,default:!0}},provide(){return{grid:this}},data:()=>({elId:`Uni_${Math.ceil(1e6*Math.random()).toString(36)}`,width:0}),created(){this.children=[]},mounted(){this.$nextTick((()=>{this.init()}))},methods:{init(){setTimeout((()=>{this._getSize((e=>{this.children.forEach(((t,i)=>{t.width=e}))}))}),50)},change(e){this.$emit("change",e)},_getSize(e){u().in(this).select(`#${this.elId}`).boundingClientRect().exec((t=>{this.width=parseInt((t[0].width-1)/this.column)+"px",e(this.width)}))}}},[["render",function(e,d,u,h,c,g){const p=n;return t(),i(p,{class:"uni-grid-wrap"},{default:s((()=>[r(p,{id:c.elId,ref:"uni-grid",class:o(["uni-grid",{"uni-grid--border":u.showBorder}]),style:l({"border-left-color":u.borderColor})},{default:s((()=>[a(e.$slots,"default",{},void 0,!0)])),_:3},8,["id","class","style"])])),_:3})}],["__scopeId","data-v-2c2326dc"]]);const y=e({components:{UserInfo:C},data(){return{user:this.getUserFromCookie()||{role:[]}}},onLoad(){const e=this.getUserFromCookie();e?this.user=e:h({url:"/pages/auth/login"})},methods:{getUserFromCookie(){const e=this.getCookie("user");if(!e)return null;try{return JSON.parse(decodeURIComponent(e))}catch(t){return console.error("解析用户信息失败:",t),null}},getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},navigateToLeave(){var e,t;(null==(t=null==(e=this.user)?void 0:e.role)?void 0:t.includes)?this.user.role.includes("student")?c({url:"/pages/leave/history"}):this.user.role.includes("instructor")?c({url:"/pages/leave/manage"}):(this.user.role.includes("monitor")||this.user.role.includes("discipline"))&&c({url:"/pages/leave/approve"}):console.error("user.role 未定义或无效")},navigateToStudy(){c({url:"/pages/studytime/studytime"})},navigateToAttendance(){c({url:"/pages/attendance/index"})},navigateToRandomPick(){this.user&&this.user.classId?c({url:`/pages/class/random-pick?classId=${this.user.classId}`}):c({url:"/pages/class/list"})},navigateToClassList(){c({url:"/pages/class/list"})},navigateToProfile(){c({url:"/pages/profile/index"})},logout(){document.cookie="user=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",h({url:"/pages/auth/login"})}}},[["render",function(e,o,l,a,u,h){const c=k,C=n,y=g("UserInfo"),w=p(m("uni-icons"),f),T=p(m("uni-grid-item"),v),I=p(m("uni-grid"),b);return t(),i(C,{class:"container"},{default:s((()=>[r(C,{class:"navbar"},{default:s((()=>[r(C,{class:"left"},{default:s((()=>[r(c,{class:"title"},{default:s((()=>[_("首页")])),_:1})])),_:1}),r(y,{user:u.user},null,8,["user"])])),_:1}),r(I,{column:2,class:"grid"},{default:s((()=>[r(T,null,{default:s((()=>[r(C,{class:"grid-item",onClick:h.navigateToLeave},{default:s((()=>[r(w,{type:"calendar",size:"30"}),r(c,null,{default:s((()=>[_("请假")])),_:1})])),_:1},8,["onClick"])])),_:1}),r(T,null,{default:s((()=>[r(C,{class:"grid-item",onClick:h.navigateToStudy},{default:s((()=>[r(w,{type:"book",size:"30"}),r(c,null,{default:s((()=>[_("背得快")])),_:1})])),_:1},8,["onClick"])])),_:1}),r(T,null,{default:s((()=>[r(C,{class:"grid-item",onClick:h.navigateToAttendance},{default:s((()=>[r(w,{type:"location",size:"30"}),r(c,null,{default:s((()=>[_("打卡")])),_:1})])),_:1},8,["onClick"])])),_:1}),r(T,null,{default:s((()=>[r(C,{class:"grid-item",onClick:h.navigateToRandomPick},{default:s((()=>[r(w,{type:"headphones",size:"30"}),r(c,null,{default:s((()=>[_("抓阉")])),_:1})])),_:1},8,["onClick"])])),_:1}),u.user.role.includes("admin")||u.user.role.includes("instructor")?(t(),i(T,{key:0},{default:s((()=>[r(C,{class:"grid-item",onClick:h.navigateToClassList},{default:s((()=>[r(w,{type:"settings",size:"30"}),r(c,null,{default:s((()=>[_("班级管理")])),_:1})])),_:1},8,["onClick"])])),_:1})):d("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-3361a180"]]);export{y as default};
