import{_ as e,q as a,s as t,t as s,f as r,u as o,g as l,j as n,k as d,c as i,w as u,i as m,o as c,a as f,m as p,v as _,p as g}from"./index-h3lAx3Le.js";import{_ as w,a as h,b as k}from"./uni-forms.CfExgS4G.js";import{s as v}from"./auth.CK2ut5yY.js";const D=e({data:()=>({formData:{studentId:"",password:""}}),methods:{async submit(){try{const e=await a.callFunction({name:"login",data:{studentId:this.formData.studentId,password:this.formData.password}});if(200===e.result.code){if(!e.result.data.token)throw new Error("登录成功，但未返回 token");v(e.result.data.user,e.result.data.token);const a=t("redirect_params");if(a&&a.leave_agree)return s("redirect_params"),void setTimeout((()=>{r({url:`/pages/leave/agree?id=${a.leave_agree}`})}),0);const o=t("redirect_after_login");s("redirect_after_login"),o?setTimeout((()=>{r({url:o})}),0):setTimeout((()=>{r({url:"/pages/index/index"})}),0)}else console.error("登录失败，错误信息:",e.result.msg),o({title:e.result.msg||"登录失败",icon:"none"})}catch(e){console.error("登录失败:",e),o({title:"登录失败",icon:"none"})}},navigateToRegister(){l({url:"/pages/auth/register"})}}},[["render",function(e,a,t,s,r,o){const l=n(d("uni-easyinput"),w),v=n(d("uni-forms-item"),h),D=_,I=g,V=m,b=n(d("uni-forms"),k);return c(),i(V,{class:"container"},{default:u((()=>[f(b,{ref:"form",model:r.formData},{default:u((()=>[f(v,{label:"学号",name:"studentId"},{default:u((()=>[f(l,{modelValue:r.formData.studentId,"onUpdate:modelValue":a[0]||(a[0]=e=>r.formData.studentId=e),placeholder:"请输入学号"},null,8,["modelValue"])])),_:1}),f(v,{label:"密码",name:"password"},{default:u((()=>[f(l,{type:"password",modelValue:r.formData.password,"onUpdate:modelValue":a[1]||(a[1]=e=>r.formData.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1}),f(D,{onClick:o.submit},{default:u((()=>[p("登录")])),_:1},8,["onClick"]),f(V,{class:"register-link"},{default:u((()=>[p(" 没有账号？"),f(I,{onClick:o.navigateToRegister},{default:u((()=>[p("立即注册")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})}],["__scopeId","data-v-58e9101e"]]);export{D as default};
