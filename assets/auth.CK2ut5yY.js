import{s as e,A as o}from"./index-h3lAx3Le.js";const t=(e,o,t={})=>{const n=["path=/",t.maxAge&&`max-age=${t.maxAge}`,t.domain&&`domain=${t.domain}`,t.secure&&"Secure",t.sameSite&&`SameSite=${t.sameSite}`].filter(Boolean).join("; ");document.cookie=`${e}=${encodeURIComponent(o)}; ${n}`},n=()=>{const e=navigator.userAgent;return/iPad|iPhone|iPod/.test(e)&&/Safari/.test(e)&&!/CriOS/.test(e)},r=()=>{if(n())try{const o=e("user");e("token");return o?JSON.parse(o):null}catch(o){return console.error("iOS存储读取失败:",o),null}else{const e=(e=>{const o=document.cookie.split("; ").find((o=>o.startsWith(`${e}=`)));return o?decodeURIComponent(o.split("=")[1]):null})("user");if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error("解析用户信息失败:",t),null}}},s=(r,s)=>{if(n())try{o("user",JSON.stringify(r)),o("token",s),console.log("iOS存储成功，验证存储:",{storedUser:e("user"),storedToken:e("token")})}catch(i){console.error("iOS存储失败:",i)}else{const e={maxAge:15552e3,domain:(()=>{if(window.location.host.includes(":5173"))return"";const e=window.location.hostname.split(".");return e.length>2?`.${e.slice(-2).join(".")}`:""})()};t("user",JSON.stringify(r),e),t("token",s,e),console.log("Cookie设置详情:",{currentURL:window.location.href,attemptToSet:{user:`user=${encodeURIComponent(JSON.stringify(r))}`,token:`token=${s}`},actualCookies:document.cookie.split("; ")})}},i=()=>{const e=r();return e?"object"==typeof e?e._id:e:null};export{r as a,i as g,s};
