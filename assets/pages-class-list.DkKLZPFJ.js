import{_ as a,f as s,q as t,g as e,h as l,j as i,k as n,c as o,w as c,i as d,o as r,a as u,m as g,d as m,x as f,y as p,F as h,p as _}from"./index-h3lAx3Le.js";import{_ as k,a as C}from"./uni-list.GCojYPXx.js";import{_ as v}from"./uni-section.CjICiUR3.js";import{U as T}from"./UserInfo.DLZ9WXF6.js";import{a as L}from"./auth.CK2ut5yY.js";const $=a({components:{UserInfo:T},data:()=>({user:{},classList:[],loading:!1,noMoreData:!1,page:1,pageSize:50}),onLoad(){const a=L();a?(this.user=a,this.loadClassList()):s({url:"/pages/auth/login"})},methods:{async loadClassList(){this.loading=!0;const a=await t.callFunction({name:"class",data:{action:"list",page:this.page,pageSize:this.pageSize}});if(a.result.data,200===a.result.code){const s=a.result.data.map((a=>a.instructor)).filter((a=>a));let e={};if(s.length>0){const a=await t.callFunction({name:"user",data:{action:"listByIds",ids:s}});a.result.data,200===a.result.code&&(e=a.result.data.reduce(((a,s)=>(a[s.studentId]=s,a)),{}))}const l=a.result.data.map((a=>{var s,t;return{...a,instructorName:(null==(s=e[a.instructor])?void 0:s.name)||"未知",instructorPhone:(null==(t=e[a.instructor])?void 0:t.studentId)||"未知"}}));1===this.page?this.classList=l:this.classList=this.classList.concat(l),this.noMoreData=a.result.data.length<this.pageSize}this.loading=!1},navigateToCreateClass(){e({url:"/pages/class/manage"})},navigateToEditClass(a){e({url:`/pages/class/manage?id=${a}`})},navigateToClassStudents(a){e({url:`/pages/class/students?id=${a}`})},navigateToClassSchedule(a){e({url:`/pages/class/schedule?id=${a}`})},navigateToRandomPick(a){e({url:`/pages/class/random-pick?classId=${a}`})},onReachBottom(){this.noMoreData||this.loading||(this.page++,this.loadClassList())}}},[["render",function(a,s,t,e,T,L){const $=_,y=d,I=l("UserInfo"),S=i(n("uni-list-item"),k),j=i(n("uni-list"),C),z=i(n("uni-section"),v);return r(),o(y,{class:"container"},{default:c((()=>[u(y,{class:"navbar"},{default:c((()=>[u(y,{class:"left"},{default:c((()=>[T.user.role.includes("admin")?(r(),o($,{key:0,class:"link",onClick:L.navigateToCreateClass},{default:c((()=>[g("创建班级")])),_:1},8,["onClick"])):m("",!0)])),_:1}),u(I,{user:T.user},null,8,["user"])])),_:1}),u(z,{title:"班级列表",type:"line"},{default:c((()=>[u(j,null,{default:c((()=>[(r(!0),f(h,null,p(T.classList,(a=>(r(),o(S,{key:a._id,title:`${a.college} - ${a.major} - ${a.className}`,note:`辅导员: ${a.instructorName} | 电话: ${a.instructorPhone}`},{footer:c((()=>[u(y,{class:"actions"},{default:c((()=>[u($,{class:"link",onClick:s=>L.navigateToEditClass(a._id)},{default:c((()=>[g("修改")])),_:2},1032,["onClick"]),u($,{class:"link",onClick:s=>L.navigateToClassStudents(a._id)},{default:c((()=>[g("学生列表")])),_:2},1032,["onClick"]),u($,{class:"link",onClick:s=>L.navigateToClassSchedule(a._id)},{default:c((()=>[g("课表管理")])),_:2},1032,["onClick"]),u($,{class:"link",onClick:s=>L.navigateToRandomPick(a._id)},{default:c((()=>[g("抓阉")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","note"])))),128))])),_:1}),T.loading?(r(),o(y,{key:0,class:"loading"},{default:c((()=>[g("加载中...")])),_:1})):m("",!0),T.noMoreData?(r(),o(y,{key:1,class:"no-more"},{default:c((()=>[g("没有更多数据了")])),_:1})):m("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-a2454722"]]);export{$ as default};
