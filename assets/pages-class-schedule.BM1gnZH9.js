import{_ as e,q as s,u as a,j as t,k as l,c,w as u,i as d,o as n,a as o,m as i,x as r,y as h,F as f,p as m,v as p,z as _,d as y}from"./index-h3lAx3Le.js";import{_ as I,a as k,b}from"./uni-forms.CfExgS4G.js";const v=e({data:()=>({classId:"",scheduleInput:"",schedule:[]}),onLoad(e){this.classId=e.id,this.loadSchedule()},methods:{async loadSchedule(){const e=await s.callFunction({name:"class_table",data:{action:"get",classId:this.classId}});200===e.result.code&&e.result.data.schedule?this.schedule=e.result.data.schedule:a({title:"未找到课表数据",icon:"none"})},parseSchedule(){if(!this.scheduleInput)return void a({title:"请输入课表内容",icon:"none"});const e=this.scheduleInput.split("\n"),s=[];let t=null;e.forEach((e=>{if((e=e.trim()).startsWith("星期")&&e.endsWith("："))t=e.replace("：",""),s.push({day:t,courses:[]});else if((e.startsWith("•")||e.startsWith("*")||e.startsWith("-"))&&t){const a=(e=e.replace(/^[•*-]\s*/,"")).match(/(\d{2}:\d{2})~(\d{2}:\d{2})：/);if(a){const[l,c,u]=a,d=e.substring(l.length).trim(),n=d.match(/(.+?)（(.+?)）/);if(n){const[e,a,l]=n;let o="";const i=d.match(/，(.+?)老师授课/);i&&(o=i[1]);let r="";const h=d.match(/地点：(.+?)$/);h&&(r=h[1]);const f=s.find((e=>e.day===t));f&&f.courses.push({start:c,end:u,label:a,type:l,teacher:o?`${o}老师`:"",location:r})}else console.warn("无法解析的课程信息:",d)}else console.warn("无法解析的时间格式:",e)}})),this.schedule=s,a({title:"解析成功",icon:"success"})},async saveSchedule(){200===(await s.callFunction({name:"class_table",data:{action:"save",classId:this.classId,schedule:this.schedule}})).result.code?a({title:"保存成功",icon:"success"}):a({title:"保存失败",icon:"none"})}}},[["render",function(e,s,a,v,S,g){const w=m,x=d,W=t(l("uni-easyinput"),I),C=t(l("uni-forms-item"),k),j=p,F=t(l("uni-forms"),b);return n(),c(x,{class:"container"},{default:u((()=>[o(x,{class:"header"},{default:u((()=>[o(w,{class:"title"},{default:u((()=>[i("课表管理")])),_:1})])),_:1}),o(x,{class:"form"},{default:u((()=>[o(F,{ref:"form"},{default:u((()=>[o(C,{label:"课表输入",name:"scheduleInput"},{default:u((()=>[o(W,{type:"textarea",modelValue:S.scheduleInput,"onUpdate:modelValue":s[0]||(s[0]=e=>S.scheduleInput=e),placeholder:"请输入课表格式，例如：\\n星期一：\\n08:30-10:00 病理学与病理生理学（理论）\\n10:30-12:00 中药学（理论）",maxlength:-1,autoHeight:!0},null,8,["modelValue"])])),_:1}),o(j,{onClick:g.parseSchedule},{default:u((()=>[i("解析课表")])),_:1},8,["onClick"])])),_:1},512),o(x,{class:"course-list"},{default:u((()=>[(n(!0),r(f,null,h(S.schedule,((e,s)=>(n(),c(x,{key:s,class:"day-schedule"},{default:u((()=>[o(w,{class:"day-title"},{default:u((()=>[i(_(e.day),1)])),_:2},1024),(n(!0),r(f,null,h(e.courses,((e,s)=>(n(),c(x,{key:s,class:"course-item"},{default:u((()=>[o(x,{class:"course-info"},{default:u((()=>[o(x,{class:"course-header"},{default:u((()=>[o(w,{class:"course-name"},{default:u((()=>[i(_(e.label),1)])),_:2},1024),o(w,{class:"course-type"},{default:u((()=>[i("("+_(e.type)+")",1)])),_:2},1024)])),_:2},1024),o(x,{class:"course-details"},{default:u((()=>[o(w,{class:"course-time"},{default:u((()=>[i(_(e.start)+" ~ "+_(e.end),1)])),_:2},1024),e.teacher?(n(),c(w,{key:0,class:"course-teacher"},{default:u((()=>[i(_(e.teacher),1)])),_:2},1024)):y("",!0),e.location?(n(),c(w,{key:1,class:"course-location"},{default:u((()=>[i("地点: "+_(e.location),1)])),_:2},1024)):y("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1}),o(j,{type:"primary",onClick:g.saveSchedule},{default:u((()=>[i("保存课表")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-79b3c858"]]);export{v as default};
