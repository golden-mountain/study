import{_ as t,j as s,U as e,k as i,h as o,o as a,c as n,w as l,a as r,d,n as u,b as p,r as h,I as c,i as m,f,q as g,u as k,g as y,m as w,x as C,y as b,F as I,p as _,W as x,v as D}from"./index-h3lAx3Le.js";import{_ as S,a as T,b as P}from"./uni-forms.CfExgS4G.js";import{_ as L}from"./uni-section.CjICiUR3.js";import{_ as v,a as M}from"./uni-list.GCojYPXx.js";import{U as V}from"./UserInfo.DLZ9WXF6.js";import{a as A}from"./auth.CK2ut5yY.js";const B=t({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const t={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(s=>{if(this.disable)return;const e=Object.keys(t).find((e=>{const i=s.key,o=t[e];return o===i||Array.isArray(o)&&o.includes(i)}));e&&setTimeout((()=>{this.$emit(e,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"}},watch:{type:{handler:function(t){this.config[t]&&this[this.config[t]](!0)},immediate:!0},isDesktop:{handler:function(t){this.config[t]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(t){this.mkclick=t},immediate:!0},isMaskClick:{handler:function(t){this.mkclick=t},immediate:!0},showPopup(t){document.getElementsByTagName("body")[0].style.overflow=t?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:this.isDesktop?"fixforpc-top":"top"}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:t,windowHeight:s,windowTop:e,safeArea:i,screenHeight:o,safeAreaInsets:a}=c();this.popupWidth=t,this.popupHeight=s+(e||0),i&&this.safeArea?this.safeAreaInsets=a.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(){document.getElementsByTagName("body")[0].style.overflow="visible"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(t){t.stopPropagation(),this.clearPropagation=!0},open(t){this.showPopup&&(clearTimeout(this.timer),this.showPopup=!1);t&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(t)||(t=this.type),this.config[t]?(this[this.config[t]](),this.$emit("change",{show:!0,type:t})):console.error("缺少类型：",t)},close(t){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(t){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(t){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0)},center(t){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},t||(this.showPopup=!0,this.showTrans=!0)},left(t){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)},right(t){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(t,c,f,g,k,y){const w=s(i("uni-transition"),e),C=m,b=o("keypress");return k.showPopup?(a(),n(C,{key:0,class:u(["uni-popup",[k.popupstyle,y.isDesktop?"fixforpc-z-index":""]])},{default:l((()=>[r(C,{onTouchstart:y.touchstart},{default:l((()=>[k.maskShow?(a(),n(w,{key:"1",name:"mask","mode-class":"fade",styles:k.maskClass,duration:k.duration,show:k.showTrans,onClick:y.onTap},null,8,["styles","duration","show","onClick"])):d("",!0),r(w,{key:"2","mode-class":k.ani,name:"content",styles:k.transClass,duration:k.duration,show:k.showTrans,onClick:y.onTap},{default:l((()=>[r(C,{class:u(["uni-popup__wrapper",[k.popupstyle]]),style:p({backgroundColor:y.bg}),onClick:y.clear},{default:l((()=>[h(t.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),k.maskShow?(a(),n(b,{key:0,onEsc:y.onTap},null,8,["onEsc"])):d("",!0)])),_:3},8,["class"])):d("",!0)}],["__scopeId","data-v-dd488718"]]);const U=t({components:{UserInfo:V},data:()=>({user:{},studentList:[],filteredStudentList:[],loading:!1,noMoreData:!1,page:1,pageSize:50,filterData:{name:"",studentIdSuffix:"",phone:""},showImportModal:!1,studentInput:""}),onLoad(t){const s=A();s?(this.user=s,this.classId=t.id,this.loadStudentList()):f({url:"/pages/auth/login"})},methods:{async loadStudentList(){this.loading=!0;const t=await g.callFunction({name:"class",data:{action:"listMembers",classId:this.classId,page:this.page,pageSize:this.pageSize}});200===t.result.code&&(1===this.page?this.studentList=t.result.data:this.studentList=this.studentList.concat(t.result.data),this.noMoreData=t.result.data.length<this.pageSize,this.applyFilter()),this.loading=!1},applyFilter(){this.filteredStudentList=this.studentList.filter((t=>{const s=!this.filterData.name||t.name.includes(this.filterData.name),e=!this.filterData.studentIdSuffix||t.studentId.endsWith(this.filterData.studentIdSuffix),i=!this.filterData.phone||t.phone.includes(this.filterData.phone);return s&&e&&i}))},async importStudents(){if(!this.studentInput)return void k({title:"请输入学生信息",icon:"none"});const t=this.studentInput.split("\n").filter((t=>t.trim())).map((t=>{const[s,e,i]=t.split(/\s+/);return{studentId:s,name:e,phone:i,class:this.classId,role:["student"],password:s}})),s=this.studentList.map((t=>t.studentId)),e=t.filter((t=>!s.includes(t.studentId)));if(0===e.length)return void k({title:"没有新学生可导入",icon:"none"});const i=await g.callFunction({name:"class",data:{action:"importStudents",students:e}});200===i.result.code?(k({title:"导入成功"}),this.studentInput="",this.showImportModal=!1,this.loadStudentList()):k({title:i.result.msg||"导入失败",icon:"none"})},formatRoles(t){const s={student:"学生",monitor:"班长",discipline:"纪委",instructor:"辅导员",admin:"管理员"};return t.map((t=>s[t]||t)).join(", ")},navigateToEditStudent(t){y({url:`/pages/student/edit?id=${t}`})},navigateToImport(){this.classId,y({url:`/pages/class/import?classId=${this.classId}`})},onReachBottom(){this.noMoreData||this.loading||(this.page++,this.loadStudentList())}}},[["render",function(t,e,u,p,h,c){const f=_,g=m,k=o("UserInfo"),y=x,V=D,A=s(i("uni-popup"),B),U=s(i("uni-easyinput"),S),$=s(i("uni-forms-item"),T),j=s(i("uni-forms"),P),E=s(i("uni-section"),L),H=s(i("uni-list-item"),v),z=s(i("uni-list"),M);return a(),n(g,{class:"container"},{default:l((()=>[r(g,{class:"navbar"},{default:l((()=>[r(g,{class:"left"},{default:l((()=>[r(f,{class:"import-link",onClick:c.navigateToImport},{default:l((()=>[w("导入学生")])),_:1},8,["onClick"])])),_:1}),r(k,{user:h.user},null,8,["user"])])),_:1}),r(A,{ref:"importPopup",type:"dialog"},{default:l((()=>[r(g,{class:"import-modal"},{default:l((()=>[r(y,{modelValue:h.studentInput,"onUpdate:modelValue":e[0]||(e[0]=t=>h.studentInput=t),placeholder:"请输入学生信息，每行格式为：学号 姓名 电话",class:"input-area",maxlength:-1},null,8,["modelValue"]),r(V,{onClick:c.importStudents},{default:l((()=>[w("导入学生")])),_:1},8,["onClick"])])),_:1})])),_:1},512),r(E,{title:"过滤条件",type:"line"},{default:l((()=>[r(j,{model:h.filterData},{default:l((()=>[r($,{label:"姓名",name:"name"},{default:l((()=>[r(U,{modelValue:h.filterData.name,"onUpdate:modelValue":e[1]||(e[1]=t=>h.filterData.name=t),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),r($,{label:"学号后两位",name:"studentIdSuffix"},{default:l((()=>[r(U,{modelValue:h.filterData.studentIdSuffix,"onUpdate:modelValue":e[2]||(e[2]=t=>h.filterData.studentIdSuffix=t),placeholder:"请输入学号后两位"},null,8,["modelValue"])])),_:1}),r($,{label:"电话",name:"phone"},{default:l((()=>[r(U,{modelValue:h.filterData.phone,"onUpdate:modelValue":e[3]||(e[3]=t=>h.filterData.phone=t),placeholder:"请输入电话"},null,8,["modelValue"])])),_:1}),r(V,{onClick:c.applyFilter},{default:l((()=>[w("应用过滤")])),_:1},8,["onClick"])])),_:1},8,["model"])])),_:1}),r(E,{title:"学生列表",type:"line"},{default:l((()=>[r(z,null,{default:l((()=>[(a(!0),C(I,null,b(h.filteredStudentList,(t=>(a(),n(H,{key:t.studentId,title:t.name,note:`学号: ${t.studentId} | 电话: ${t.phone} | 身份: ${c.formatRoles(t.role)}`},{footer:l((()=>[r(g,{class:"actions"},{default:l((()=>[r(f,{class:"link",onClick:s=>c.navigateToEditStudent(t.studentId)},{default:l((()=>[w("修改")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","note"])))),128))])),_:1}),h.loading?(a(),n(g,{key:0,class:"loading"},{default:l((()=>[w("加载中...")])),_:1})):d("",!0),h.noMoreData?(a(),n(g,{key:1,class:"no-more"},{default:l((()=>[w("没有更多数据了")])),_:1})):d("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-ee645192"]]);export{U as default};
