import{_ as e,o as a,c as t,w as l,x as n,F as o,y as r,n as s,b as u,a as c,m as i,z as d,p as v,i as m,q as y,s as k,A as f,B as h,C as w,D as _,E as p,u as g,G as b,H as x,I as B,J as I,K as A,j as C,k as z,l as q,L as E,M as S,d as M,t as T,v as $,S as F,N as Q,O as V,P as N,Q as D}from"./index-h3lAx3Le.js";import{a as O,_ as G,b as J}from"./uni-forms.CfExgS4G.js";import{g as j}from"./auth.CK2ut5yY.js";const U=e({name:"UniSegmentedControl",emits:["clickItem"],props:{current:{type:Number,default:0},values:{type:Array,default:()=>[]},activeColor:{type:String,default:"#2979FF"},styleType:{type:String,default:"button"}},data:()=>({currentIndex:0}),watch:{current(e){e!==this.currentIndex&&(this.currentIndex=e)}},created(){this.currentIndex=this.current},methods:{_onClick(e){this.currentIndex!==e&&(this.currentIndex=e,this.$emit("clickItem",{currentIndex:e}))}}},[["render",function(e,y,k,f,h,w){const _=v,p=m;return a(),t(p,{class:s([["text"===k.styleType?"segmented-control--text":"segmented-control--button"],"segmented-control"]),style:u({borderColor:"text"===k.styleType?"":k.activeColor})},{default:l((()=>[(a(!0),n(o,null,r(k.values,((e,n)=>(a(),t(p,{class:s([["text"===k.styleType?"":"segmented-control__item--button",n===h.currentIndex&&"button"===k.styleType?"segmented-control__item--button--active":"",0===n&&"button"===k.styleType?"segmented-control__item--button--first":"",n===k.values.length-1&&"button"===k.styleType?"segmented-control__item--button--last":""],"segmented-control__item"]),key:n,style:u({backgroundColor:n===h.currentIndex&&"button"===k.styleType?k.activeColor:"",borderColor:n===h.currentIndex&&"text"===k.styleType||"button"===k.styleType?k.activeColor:"transparent"}),onClick:e=>w._onClick(n)},{default:l((()=>[c(p,null,{default:l((()=>[c(_,{style:u({color:n===h.currentIndex?"text"===k.styleType?k.activeColor:"#fff":"text"===k.styleType?"#000":k.activeColor}),class:s(["segmented-control__text","text"===k.styleType&&n===h.currentIndex?"segmented-control__item--text":""])},{default:l((()=>[i(d(e),1)])),_:2},1032,["style","class"])])),_:2},1024)])),_:2},1032,["class","style","onClick"])))),128))])),_:1},8,["class","style"])}],["__scopeId","data-v-cd8f471b"]]),H=e({__name:"studytime",setup(e){const u=h(0),H=h(["知识库","创建题库"]),K=h(""),L=h(""),P=h([{value:"中医基础理论",text:"中医基础理论"},{value:"中医诊断学",text:"中医诊断学"},{value:"中药学",text:"中药学"},{value:"方剂学",text:"方剂学"},{value:"中医内科学",text:"中医内科学"},{value:"中医外科学",text:"中医外科学"},{value:"中医妇科学",text:"中医妇科学"},{value:"中医儿科学",text:"中医儿科学"},{value:"针灸学",text:"针灸学"},{value:"推拿学",text:"推拿学"},{value:"中医骨伤科学",text:"中医骨伤科学"},{value:"中医养生学",text:"中医养生学"},{value:"中医经典选读",text:"中医经典选读"},{value:"解剖学",text:"解剖学"},{value:"生理学",text:"生理学"},{value:"病理学",text:"病理学"},{value:"药理学",text:"药理学"},{value:"诊断学",text:"诊断学"},{value:"内科学",text:"内科学"},{value:"外科学",text:"外科学"},{value:"妇产科学",text:"妇产科学"},{value:"儿科学",text:"儿科学"},{value:"急诊医学",text:"急诊医学"},{value:"医学影像学",text:"医学影像学"},{value:"临床技能学",text:"临床技能学"}]);h("");const W=h([]),Y=h([]),R=h(1),X=h(10);h(!0);const Z=h(!1),ee=h({title:"",textbook:"",content:"",autoGenerate:!1}),ae={getQuestionBanks:async e=>{try{const a=await y.callFunction({name:"memorized",data:{action:"getQuestionBanks",params:{page:e.page,pageSize:e.pageSize,textbook:e.textbook,search:e.search,status:e.status}}});return{code:a.result.code||200,data:a.result.data,total:a.result.total,hasMore:a.result.hasMore}}catch(a){throw console.error("获取题库列表失败:",a),new Error("获取题库列表失败")}},generateQuestions:async e=>{try{const t={messages:[{role:"system",content:"你是一个专业的题库生成助手，根据用户提供的学习内容生成高质量的练习题，确保覆盖所有知识点。"},{role:"user",content:e}]},l=12e4,n=await y.callFunction({name:"deepseekChat",data:t,timeout:l});if(0!==n.result.code)throw new Error(n.result.message||"生成题库失败");try{const e=n.result.data.text.replace(/```json\n|\n```/g,"");return JSON.parse(e)}catch(a){throw console.error("解析题库数据失败:",a),new Error("题库数据格式错误")}}catch(t){throw console.error("生成题库失败:",t),new Error("题库生成服务暂时不可用")}},saveQuestionBank:async e=>{try{if(!Array.isArray(e.memoryBank)||!Array.isArray(e.choiceBank))throw new Error("题库数据格式错误");const a=await y.callFunction({name:"saveQuestionBank",data:{title:e.title,textbook:e.textbook,content:e.content,memoryBank:e.memoryBank,choiceBank:e.choiceBank,difficulty:e.difficulty}});if(0===a.result.code)return{success:!0,data:a.result.data};throw new Error(a.result.error||"保存题库失败")}catch(a){throw console.error("保存题库失败:",a),new Error("保存题库失败，请稍后重试")}},getQuestionBankDetail:async e=>{if(!e)throw new Error("题库ID不能为空");try{let t=null;try{const a=k(`questionBank_${e}`);a&&(t=JSON.parse(a))}catch(a){}const l=await y.callFunction({name:"getQuestionBankDetail",data:{bankId:e}});if(200===l.result.code){const t=l.result.data;let n=[];if(t.questions)if("string"==typeof t.questions)try{n=JSON.parse(t.questions)}catch(a){console.error("解析 questions 字符串失败:",a),n=[]}else Array.isArray(t.questions)&&(n=t.questions);else(t.memoryBank||t.choiceBank)&&(n=[...Array.isArray(t.memoryBank)?t.memoryBank.map((e=>({...e,type:"blank"}))):[],...Array.isArray(t.choiceBank)?t.choiceBank.map((e=>({...e,type:"choice"}))):[]]);const o={...t,questions:n};try{f(`questionBank_${e}`,JSON.stringify(o))}catch(a){}return o}if(t)return t;throw new Error(l.result.msg||"获取题库详情失败")}catch(t){console.error("获取题库详情失败:",t);try{const a=k(`questionBank_${e}`);if(a)return JSON.parse(a)}catch(a){}throw new Error("获取题库详情失败，请检查网络或题库ID是否正确")}},updateQuestionBank:async(e,a)=>{try{if(!Array.isArray(a.memoryBank)||!Array.isArray(a.choiceBank))throw new Error("题库数据格式错误");const t=await y.callFunction({name:"updateQuestionBank",data:{bankId:e,title:a.title,textbook:a.textbook,content:a.content,memoryBank:a.memoryBank,choiceBank:a.choiceBank,difficulty:a.difficulty}});if(0===t.result.code)return{success:!0,data:t.result.data};throw new Error(t.result.error||"更新题库失败")}catch(t){throw console.error("更新题库失败:",t),new Error("更新题库失败，请稍后重试")}},updateMemorizedCount:async({userId:e,bankId:a})=>{try{const t=await y.callFunction({name:"updateMemorizedCount",data:{userId:e,bankId:a}});if(0===t.result.code)return{success:!0,data:t.result.data};throw new Error(t.result.error||"更新背诵次数失败")}catch(t){throw console.error("更新背诵次数失败:",t),new Error("更新背诵次数失败，请稍后重试")}},resetMemorizedCount:async({userId:e,bankId:a})=>{try{const t=await y.callFunction({name:"resetMemorizedCount",data:{userId:e,bankId:a}});if(0===t.result.code)return{success:!0,data:t.result.data};throw new Error(t.result.error||"重置背诵次数失败")}catch(t){throw console.error("重置背诵次数失败:",t),new Error("重置背诵次数失败，请稍后重试")}},getMemorizedBanks:async e=>{try{const a=await y.callFunction({name:"memorized",data:{action:"getMemorizedBanks",params:{userId:e.userId,page:e.page,pageSize:e.pageSize}}});return{data:a.result.data,total:a.result.total,hasMore:a.result.hasMore}}catch(a){throw console.error("获取已背题库列表失败:",a),new Error("获取已背题库列表失败")}},markAsMemorized:async({userId:e,bankId:a})=>{try{const t=await y.callFunction({name:"memorized",data:{action:"markAsMemorized",params:{userId:e,bankId:a}}});if(0===t.result.errCode)return{success:!0,data:t.result.data};throw new Error(t.result.errMsg||"标记已背失败")}catch(t){throw console.error("标记已背失败:",t),new Error("标记已背失败，请稍后重试")}},resetMemorized:async({userId:e,bankId:a})=>{try{const t=await y.callFunction({name:"memorized",data:{action:"resetMemorized",params:{userId:e,bankId:a}}});if(0===t.result.errCode)return{success:!0,data:t.result.data};throw new Error(t.result.errMsg||"重置未背失败")}catch(t){throw console.error("重置未背失败:",t),new Error("重置未背失败，请稍后重试")}}},te=h("all"),le=h(0),ne=h(0),oe=h([]),re=h(0);let se=null,ue=null,ce=0,ie=null,de=null;const ve=()=>{0===re.value?"all"===te.value?oe.value=W.value:"memorized"===te.value?(oe.value=W.value.filter((e=>e.memorized)),0===oe.value.length&&Y.value.length>0&&(oe.value=Y.value)):oe.value=W.value.filter((e=>!e.memorized)):oe.value=Y.value,be.value&&(ge.value=oe.value.findIndex((e=>e._id===be.value._id)),-1===ge.value&&(be.value=null))},me=()=>{se&&clearTimeout(se),se=setTimeout((()=>{je.value=1;const e=be.value?be.value._id:null;Ke(),e&&setTimeout((()=>{const a=oe.value.findIndex((a=>a._id===e));-1!==a?(ge.value=a,be.value=oe.value[a]):(ge.value=-1,be.value=null)}),500)}),300)};w((async()=>{try{if(!j())throw new Error("用户未登录");await Ie(je.value),await Ae(je.value),ve();const e=_().query.bankId;if(e){const a=W.value.findIndex((a=>a._id===e));-1!==a&&xe(a),await Ve(e)}Fe(),p((()=>{Fe()}))}catch(e){console.error("初始化失败:",e),g({title:"初始化失败，请检查网络或重新登录",icon:"none",duration:2e3})}}));const ye=()=>{ie&&clearTimeout(ie),ie=setTimeout((()=>{je.value=1,Ke()}),300)},ke=e=>{u.value=e.currentIndex,0===u.value&&Ie(je.value)},fe=async()=>{try{return ee.value.autoGenerate?await he():await we()}catch(e){g({title:"题库生成失败",icon:"none"})}},he=async()=>{b({title:"正在自动生成题库，请稍候...",mask:!0});const e=`根据以下信息自动生成教材章节的重点内容和题库：\n标题：${ee.value.title}\n教材：${ee.value.textbook}\n\n要求：\n1. 先总结本章节的要考试的全部重点内容\n2. 根据重点内容生成记忆题库和选择题库\n3. 使用JSON格式返回，包含以下字段：\n   - summary: 章节重点内容总结\n   - memoryBank: 记忆题库（每个题目包含question和answer字段）\n   - choiceBank: 选择题库（每个题目包含question、options和answer字段）`,a=await ae.generateQuestions(e);ee.value.content=a.summary,Ce.value=[...a.memoryBank.map((e=>({...e,showAnswer:!1}))),...a.choiceBank.map((e=>({...e,showAnswer:!1})))],ze.value=!0,x(),g({title:"题库自动生成成功",icon:"success"})},we=async()=>{const e=`根据以下学习内容生成记忆题库和选择题库：\n标题：${ee.value.title}\n教材：${ee.value.textbook}\n内容：${ee.value.content}\n\n要求：\n1. 确保覆盖所有知识点\n2. 记忆题库：每个知识点生成1道填空题，挖空所有关键词\n3. 选择题库：每个知识点生成1道选择题，包含问题和4个选项\n4. 使用JSON格式返回，包含以下字段：\n   - memoryBank: 记忆题库\n   - choiceBank: 选择题库`;b({title:"正在生成题库，请稍候...",mask:!0});const a=await ae.generateQuestions(e),t={memoryBank:(a.memoryBank||[]).map((e=>({...e,answer:Array.isArray(e.answer)?e.answer.join(", "):e.answer,showAnswer:!1}))),choiceBank:(a.choiceBank||[]).map(_e)};Ce.value=[...t.memoryBank,...t.choiceBank],ze.value=!0,x(),g({title:"题库生成成功",icon:"success"})},_e=e=>({...e,answer:Array.isArray(e.answer)?e.answer.join(", "):e.answer,options:(e.options||[]).map((e=>null==e?void 0:e.replace(/[""'']/g,""))),type:e.type||"blank"}),pe=async()=>{try{if(!ee.value.title)throw new Error("标题不能为空");const e=Ce.value.filter((e=>!e.options)),a=Ce.value.filter((e=>e.options)),t={title:ee.value.title,textbook:ee.value.textbook,content:ee.value.content,memoryBank:e.map((e=>({question:e.question,answer:e.answer,explanation:e.explanation||""}))),choiceBank:a.map((e=>({question:e.question,options:e.options,answer:e.answer,explanation:e.explanation||""}))),difficulty:3};let l;if(l=Oe.value?await ae.updateQuestionBank(Ge.value,t):await ae.saveQuestionBank(t),!l.success)throw new Error(Oe.value?"更新失败":"保存失败");g({title:Oe.value?"更新成功":"保存成功",icon:"success"}),ee.value={title:"",textbook:"",content:"",autoGenerate:!1},Ce.value=[],ze.value=!1,Oe.value=!1,Ge.value=null,R.value=1,W.value=[],await Ie()}catch(e){console.error("操作失败:",e),g({title:`操作失败：${e.message||"未知错误"}`,icon:"none",duration:3e3})}},ge=h(-1),be=h(null),xe=async e=>{try{const t=oe.value[e];if(!t)throw console.error("题库不存在"),new Error("题库不存在");if(ge.value===e&&be.value&&be.value._id===t._id&&(be.value.memoryBank&&be.value.memoryBank.length>0||be.value.choiceBank&&be.value.choiceBank.length>0))return void($e.value&&(Te.value=!1));b({title:"加载中...",mask:!0}),ge.value=e,be.value={...t};const l=t._id;try{if(await Ve(l)){const e=W.value.find((e=>e._id===l));e&&(be.value=e,be.value.memoryBank&&be.value.memoryBank.forEach((e=>{e.showAnswer=!1})),be.value.choiceBank&&be.value.choiceBank.forEach((e=>{e.showAnswer=!1})))}else be.value.loadFailed=!0}catch(a){be.value.loadFailed=!0,g({title:"加载题库详情失败，请稍后重试",icon:"none",duration:2e3})}u.value=0,$e.value&&(Te.value=!1),x()}catch(a){x(),console.error("选择题库失败:",a),g({title:"选择题库失败，请稍后重试",icon:"none",duration:2e3})}},Be=e=>{const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},Ie=async e=>{try{if(Z.value)return;const t=++ce;Z.value=!0;let l=!1;try{b({title:"加载中...",mask:!0}),l=!0}catch(a){console.error("显示加载提示失败:",a)}const n={page:e,pageSize:X.value,textbook:L.value,search:K.value,status:te.value},o=await ae.getQuestionBanks(n);if(t!==ce)return;if(W.value=o.data,le.value=o.total,ve(),be.value){W.value.some((e=>e._id===be.value._id))?ge.value=oe.value.findIndex((e=>e._id===be.value._id)):(be.value=null,ge.value=-1)}}catch(t){console.error("加载题库列表失败:",t),g({title:"加载题库列表失败，请稍后重试",icon:"none",duration:2e3})}finally{try{x()}catch(a){console.error("隐藏加载提示失败:",a)}Z.value=!1}},Ae=async e=>{try{if(Z.value)return;Z.value=!0;let t=!1;try{b({title:"加载中...",mask:!0}),t=!0}catch(a){}const l=j(),n=await ae.getMemorizedBanks({userId:l,page:e,pageSize:X.value});Y.value=n.data.map((e=>({_id:e.bankId,title:e.title,textbook:e.textbook,memorizedAt:e.memorizedAt,memorized:!0}))),ne.value=n.total,ve()}catch(t){g({title:"加载失败，请稍后重试",icon:"none",duration:2e3})}finally{try{x()}catch(a){}Z.value=!1}},Ce=h([]),ze=h(!1),qe=h(0),Ee=h(["要背的内容","记忆题库","选择题库"]),Se=e=>{qe.value=e.currentIndex},Me=async e=>{const a=(e=>`${window.location.origin}/h5/?bankId=${e}`)(e);await D({data:a}),g({title:"链接已复制",icon:"none",duration:1500})},Te=h(!1),$e=h(!1),Fe=()=>{const{windowWidth:e}=B();$e.value=e<768},Qe=e=>{e&&(e.showAnswer=!e.showAnswer)},Ve=async e=>{try{if(!e)throw new Error("题库ID不能为空");const a=await ae.getQuestionBankDetail(e);if(!a)throw new Error("题库数据为空");let t=[],l=[];if(a.memoryBank||a.choiceBank)t=Array.isArray(a.memoryBank)?a.memoryBank:[],l=Array.isArray(a.choiceBank)?a.choiceBank:[];else if(a.questions){const e=Array.isArray(a.questions)?a.questions:"string"==typeof a.questions?JSON.parse(a.questions):[];t=e.filter((e=>"blank"===e.type)),l=e.filter((e=>"choice"===e.type))}const n={...a,memoryBank:t,choiceBank:l,title:a.title||"未命名题库",textbook:a.textbook||"未分类",content:a.content||"",createdAt:a.createdAt||(new Date).toISOString(),_id:e},o=W.value.findIndex((a=>a._id===e));return-1===o?W.value.push(n):W.value[o]={...W.value[o],...n},be.value&&be.value._id===e&&(be.value=n,be.value.memoryBank&&be.value.memoryBank.forEach((e=>{e.showAnswer=!1})),be.value.choiceBank&&be.value.choiceBank.forEach((e=>{e.showAnswer=!1}))),Ne(),n}catch(a){return g({title:`加载失败：${a.message||"未知错误"}`,icon:"none",duration:3e3}),be.value&&be.value._id===e&&(be.value.loadFailed=!0),null}},Ne=()=>{const e=be.value;be.value=null,I((()=>{be.value=e,I((()=>{}))}))},De=()=>{ee.value.autoGenerate=!ee.value.autoGenerate},Oe=h(!1),Ge=h(null),Je=e=>{de&&clearTimeout(de),de=setTimeout((async()=>{const a=e.currentIndex;re.value=a,te.value,te.value=0===a?"all":1===a?"memorized":"unmemorized",je.value=1,"memorized"===te.value?(await Ae(je.value),0===Y.value.length&&g({title:"暂无已背题库",icon:"none",duration:2e3})):Ke()}),300)},je=h(1),Ue=()=>{je.value>1&&(je.value--,Ke())},He=()=>{je.value<Le.value&&(je.value++,Ke())},Ke=()=>{ue&&clearTimeout(ue),ue=setTimeout((()=>{0===u.value?Ie(je.value):Ae(je.value)}),200)},Le=A((()=>0===u.value?Math.ceil(le.value/X.value):Math.ceil(ne.value/X.value))),Pe=e=>Array.isArray(e)?e.join(", "):"string"==typeof e?e:null==e?"无答案":String(e);return(e,y)=>{const k=C(z("uni-segmented-control"),U),f=C(z("uni-icons"),q),h=$,w=m,_=C(z("uni-data-select"),E),p=C(z("uni-search-bar"),S),B=v,I=F,A=Q,D=V,Y=C(z("uni-forms-item"),O),R=C(z("uni-easyinput"),G),X=C(z("uni-forms"),J);return a(),t(w,{class:"studytime-container"},{default:l((()=>[c(k,{current:Number(u.value),values:H.value,onClickItem:ke},null,8,["current","values"]),$e.value?(a(),t(h,{key:0,class:"toggle-list-btn",onClick:y[0]||(y[0]=e=>Te.value=!Te.value)},{default:l((()=>[c(f,{type:Te.value?"close":"list",size:"24",color:"#fff"},null,8,["type"])])),_:1})):M("",!0),c(w,{class:"two-column-layout"},{default:l((()=>[$e.value&&Te.value?(a(),t(w,{key:0,class:"overlay",onClick:y[1]||(y[1]=e=>Te.value=!1)})):M("",!0),c(w,{class:s(["left-column",{"mobile-hidden":$e.value&&!Te.value,"mobile-slide-in":$e.value&&Te.value}])},{default:l((()=>[c(_,{modelValue:L.value,"onUpdate:modelValue":y[2]||(y[2]=e=>L.value=e),localdata:P.value,placeholder:"选择教材",clear:!0,onChange:me,style:{"margin-bottom":"10px"}},null,8,["modelValue","localdata"]),c(p,{modelValue:K.value,"onUpdate:modelValue":y[3]||(y[3]=e=>K.value=e),placeholder:"搜索知识库标题",onConfirm:ye},null,8,["modelValue"]),c(w,{class:"filter-section"},{default:l((()=>[c(k,{current:"all"===te.value?0:"memorized"===te.value?1:2,values:["全部","已背"],onClickItem:Je},null,8,["current"])])),_:1}),c(w,{class:"pagination"},{default:l((()=>[c(B,{class:"page-button",onClick:Ue},{default:l((()=>[i("上一页")])),_:1}),c(B,{class:"page-info"},{default:l((()=>[i("第 "+d(je.value)+" 页 / 共 "+d(Le.value)+" 页",1)])),_:1}),c(B,{class:"page-button",onClick:He},{default:l((()=>[i("下一页")])),_:1})])),_:1}),c(w,{class:"total-info"},{default:l((()=>[c(B,null,{default:l((()=>[i("全部题库: "+d(le.value),1)])),_:1}),c(B,null,{default:l((()=>[i("已背题库: "+d(ne.value),1)])),_:1})])),_:1}),c(I,{class:"bank-list","scroll-y":""},{default:l((()=>[(a(!0),n(o,null,r(oe.value,((e,n)=>(a(),t(w,{key:e._id,class:s(["bank-item",{active:ge.value===n,memorized:e.memorized}]),onClick:e=>xe(n)},{default:l((()=>[c(w,{class:"bank-header"},{default:l((()=>[c(B,{class:"bank-title"},{default:l((()=>[i(d(e.title),1)])),_:2},1024),c(B,{onClick:N((a=>Me(e._id)),["stop"])},{default:l((()=>[i("分享")])),_:2},1032,["onClick"]),0===re.value?(a(),t(B,{key:0,onClick:N((a=>(e=>{u.value=1,Oe.value=!0,Ge.value=e._id,ee.value={title:e.title,textbook:e.textbook,content:e.content,autoGenerate:!1,bankId:e._id},Ce.value=[...(e.memoryBank||[]).map((e=>({...e,showAnswer:!1}))),...(e.choiceBank||[]).map((e=>({...e,showAnswer:!1})))],$e.value&&(Te.value=!1)})(e)),["stop"])},{default:l((()=>[i("编辑")])),_:2},1032,["onClick"])):M("",!0)])),_:2},1024),c(B,{class:"bank-textbook"},{default:l((()=>[i(d(e.textbook),1)])),_:2},1024),c(w,{class:"bank-stats"})])),_:2},1032,["class","onClick"])))),128)),0===oe.value.length?(a(),t(w,{key:0,class:"empty-banks"},{default:l((()=>["memorized"===te.value?(a(),t(B,{key:0},{default:l((()=>[i('暂无已背题库，请先标记题库为"已背"')])),_:1})):(a(),t(B,{key:1},{default:l((()=>[i("暂无符合条件的题库")])),_:1}))])),_:1})):M("",!0)])),_:1})])),_:1},8,["class"]),c(w,{class:"right-column"},{default:l((()=>[0===u.value?(a(),t(w,{key:0,class:"view-tab"},{default:l((()=>[be.value?(a(),t(w,{key:0,class:"bank-detail"},{default:l((()=>[c(w,{class:"detail-header"},{default:l((()=>[c(B,{class:"detail-title"},{default:l((()=>[i(d(be.value.title),1)])),_:1}),c(w,{class:"memorized-actions"},{default:l((()=>[be.value.memorized?(a(),t(B,{key:1,class:"reset-memorized-link",onClick:y[5]||(y[5]=e=>(async e=>{try{b({title:"处理中...",mask:!0});const a=j();await ae.resetMemorized({userId:a,bankId:e});const t=W.value.find((a=>a._id===e));t&&(t.memorized=!1),await Ae(je.value),"memorized"===te.value&&ve(),g({title:"重背成功",icon:"success",duration:2e3})}catch(a){console.error("重背失败:",a),g({title:"重背失败，请稍后重试",icon:"none",duration:2e3})}finally{x()}})(be.value._id))},{default:l((()=>[i(" 重背 ")])),_:1})):(a(),t(B,{key:0,class:"mark-memorized-link",onClick:y[4]||(y[4]=e=>(async e=>{try{b({title:"处理中...",mask:!0});const a=j();await ae.markAsMemorized({userId:a,bankId:e});const t=W.value.find((a=>a._id===e));t&&(t.memorized=!0),await Ae(je.value),"memorized"===te.value&&ve(),g({title:"标记成功",icon:"success",duration:2e3})}catch(a){console.error("标记为已背失败:",a),g({title:"标记失败，请稍后重试",icon:"none",duration:2e3})}finally{x()}})(be.value._id))},{default:l((()=>[i(" 标记已背 ")])),_:1}))])),_:1})])),_:1}),c(B,{class:"detail-textbook"},{default:l((()=>[i("教材: "+d(be.value.textbook),1)])),_:1}),c(B,{class:"detail-date"},{default:l((()=>[i("创建时间: "+d(Be(be.value.createdAt)),1)])),_:1}),be.value.loadFailed?(a(),t(w,{key:0,class:"error-message"},{default:l((()=>[c(B,null,{default:l((()=>[i("题库内容加载失败")])),_:1}),c(h,{class:"retry-btn",onClick:y[6]||(y[6]=e=>(async e=>{try{if(!e)throw new Error("题库ID不能为空");try{T(`questionBank_${e}`)}catch(a){}if(b({title:"重新加载中...",mask:!0}),await Ve(e)){const a=W.value.find((a=>a._id===e));a&&(be.value=a,be.value.memoryBank&&be.value.memoryBank.forEach((e=>{void 0===e.showAnswer&&(e.showAnswer=!1)})),be.value.choiceBank&&be.value.choiceBank.forEach((e=>{void 0===e.showAnswer&&(e.showAnswer=!1)})),g({title:"重新加载成功",icon:"success",duration:2e3}))}else g({title:"重新加载失败",icon:"none",duration:2e3});x()}catch(t){console.error("重试加载题库失败:",t),x(),g({title:"重新加载失败，请稍后再试",icon:"none",duration:2e3})}})(be.value._id))},{default:l((()=>[i("重试加载")])),_:1})])),_:1})):M("",!0),c(k,{current:Number(qe.value),values:Ee.value,onClickItem:Se,style:{margin:"20px 0"}},null,8,["current","values"]),0===qe.value?(a(),t(w,{key:1,class:"tab-content"},{default:l((()=>[c(w,{class:"original-content"},{default:l((()=>[c(B,{class:"content-title"},{default:l((()=>[i("要背的内容:")])),_:1}),c(B,{class:"content-text"},{default:l((()=>[i(d(be.value.content),1)])),_:1})])),_:1})])),_:1})):M("",!0),1===qe.value?(a(),t(w,{key:2,class:"tab-content"},{default:l((()=>[c(w,{class:"bank-type"},{default:l((()=>[c(B,{class:"bank-type-title"},{default:l((()=>[i("记忆题库（填空题）")])),_:1}),be.value.memoryBank&&be.value.memoryBank.length>0?(a(!0),n(o,{key:0},r(be.value.memoryBank,((e,n)=>(a(),t(w,{key:n,class:"question-item"},{default:l((()=>[c(B,{class:"question-text"},{default:l((()=>[i(d(e.question),1)])),_:2},1024),e.showAnswer?(a(),t(w,{key:0,class:"answer-section"},{default:l((()=>[c(B,{class:"answer-label"},{default:l((()=>[i("答案:")])),_:1}),c(B,{class:"answer"},{default:l((()=>[i(d(Pe(e.answer)),1)])),_:2},1024)])),_:2},1024)):M("",!0),c(B,{class:"toggle-answer-text",onClick:a=>Qe(e)},{default:l((()=>[i(d(e.showAnswer?"隐藏答案":"显示答案"),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128)):M("",!0),be.value.memoryBank&&0!==be.value.memoryBank.length?M("",!0):(a(),t(w,{key:1,class:"empty-questions"},{default:l((()=>[c(B,null,{default:l((()=>[i("暂无记忆题")])),_:1})])),_:1}))])),_:1})])),_:1})):M("",!0),2===qe.value?(a(),t(w,{key:3,class:"tab-content"},{default:l((()=>[c(w,{class:"bank-type"},{default:l((()=>[c(B,{class:"bank-type-title"},{default:l((()=>[i("选择题库")])),_:1}),be.value.choiceBank&&be.value.choiceBank.length>0?(a(!0),n(o,{key:0},r(be.value.choiceBank,((e,s)=>(a(),t(w,{key:s,class:"question-item"},{default:l((()=>[c(B,{class:"question-text"},{default:l((()=>[i(d(e.question),1)])),_:2},1024),c(w,{class:"options"},{default:l((()=>[(a(!0),n(o,null,r(e.options,((e,n)=>(a(),t(w,{key:n,class:"option"},{default:l((()=>[i(d(String.fromCharCode(65+n))+". "+d(e),1)])),_:2},1024)))),128))])),_:2},1024),e.showAnswer?(a(),t(w,{key:0,class:"answer-section"},{default:l((()=>[c(B,{class:"answer-label"},{default:l((()=>[i("答案:")])),_:1}),c(B,{class:"answer"},{default:l((()=>[i(d(Pe(e.answer)),1)])),_:2},1024)])),_:2},1024)):M("",!0),c(B,{class:"toggle-answer-text",onClick:a=>Qe(e)},{default:l((()=>[i(d(e.showAnswer?"隐藏答案":"显示答案"),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128)):M("",!0),be.value.choiceBank&&0!==be.value.choiceBank.length?M("",!0):(a(),t(w,{key:1,class:"empty-questions"},{default:l((()=>[c(B,null,{default:l((()=>[i("暂无选择题")])),_:1})])),_:1}))])),_:1})])),_:1})):M("",!0)])),_:1})):(a(),t(w,{key:1,class:"empty-state"},{default:l((()=>[c(B,null,{default:l((()=>[i("请从左侧选择一个知识库")])),_:1})])),_:1}))])),_:1})):M("",!0),1===u.value?(a(),t(w,{key:1,class:"create-tab"},{default:l((()=>[c(w,{class:"input-section"},{default:l((()=>[c(X,{ref:"form",model:ee.value},{default:l((()=>[c(Y,{label:"生成方式",name:"title"},{default:l((()=>[c(w,{class:"auto-generate"},{default:l((()=>[c(D,null,{default:l((()=>[c(A,{checked:ee.value.autoGenerate,onClick:De},null,8,["checked"]),i(" 自动生成 ")])),_:1})])),_:1})])),_:1}),c(Y,{label:"标题",name:"title"},{default:l((()=>[c(R,{modelValue:ee.value.title,"onUpdate:modelValue":y[7]||(y[7]=e=>ee.value.title=e),placeholder:"请输入题库标题"},null,8,["modelValue"])])),_:1}),c(Y,{label:"教材",name:"textbook"},{default:l((()=>[c(_,{modelValue:ee.value.textbook,"onUpdate:modelValue":y[8]||(y[8]=e=>ee.value.textbook=e),localdata:P.value,placeholder:"请选择教材",clear:!1},null,8,["modelValue","localdata"])])),_:1}),ee.value.autoGenerate?M("",!0):(a(),t(Y,{key:0,label:"重点内容",name:"content"},{default:l((()=>[c(R,{type:"textarea",modelValue:ee.value.content,"onUpdate:modelValue":y[9]||(y[9]=e=>ee.value.content=e),placeholder:"请输入重点内容",maxlength:1e3,"auto-height":!0},null,8,["modelValue"])])),_:1})),c(w,{class:"generate-buttons"},{default:l((()=>[c(h,{class:"generate-btn primary",onClick:fe},{default:l((()=>[i("生成题库")])),_:1})])),_:1}),Ce.value.length>0?(a(),t(w,{key:1,class:"preview-section"},{default:l((()=>[c(w,{class:"preview-header"},{default:l((()=>[c(B,{class:"preview-title"},{default:l((()=>[i("题库预览")])),_:1}),c(h,{class:"save-btn",onClick:pe},{default:l((()=>[i(d(Oe.value?"更新题库":"保存题库"),1)])),_:1})])),_:1}),c(w,{class:"questions-preview"},{default:l((()=>[(a(!0),n(o,null,r(Ce.value,((e,s)=>(a(),t(w,{key:s,class:"question-preview"},{default:l((()=>[c(B,{class:"question-text"},{default:l((()=>[i(d(e.question),1)])),_:2},1024),e.options?(a(),t(w,{key:0,class:"options"},{default:l((()=>[(a(!0),n(o,null,r(e.options,((e,n)=>(a(),t(w,{key:n,class:"option"},{default:l((()=>[i(d(String.fromCharCode(65+n))+". "+d(e),1)])),_:2},1024)))),128))])),_:2},1024)):M("",!0),e.showAnswer?(a(),t(w,{key:1,class:"answer-section"},{default:l((()=>[c(B,{class:"answer-label"},{default:l((()=>[i("答案:")])),_:1}),c(B,{class:"answer"},{default:l((()=>[i(d(e.answer),1)])),_:2},1024)])),_:2},1024)):M("",!0),c(B,{class:"toggle-answer-text",onClick:a=>Qe(e)},{default:l((()=>[i(d(e.showAnswer?"隐藏答案":"显示答案"),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})):M("",!0)])),_:1},8,["model"])])),_:1})])),_:1})):M("",!0)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-837bd830"]]);export{H as default};
